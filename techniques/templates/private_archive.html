{% extends 'base_techniques.html' %}

{% block content %}
    <div class="private-archive-wrapper">
        <h1>Your Private Archive</h1>

        <div class="error-message">
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        </div>

        {% for technique in private_techniques %}
            <div class="one-technique">
                <div class="technique-title">
                    <a href="{% url 'edit' technique.id %}">{{ technique.name|title }}</a>
                </div>
                {% if technique.video_option == 'full' %}
                    <div class="one-video-player">
                        <iframe width="560" height="315" src="{{ technique.embed_url }}" frameborder="0" allowfullscreen></iframe>
                    </div>
                {% endif %}
                {% if technique.video_option == 'cropped' %}
                    <div class="one-video-player">
                        Under Constructions
                    </div>
                {% endif %}

                <div class="one-note-div" id="{{ technique.id }}-note-div" style="display: none;">
                    <div id="{{ technique.id }}-note" class="one-note">
                        {% if technique.note == None %}
                            <p>No note yet.</p>
                        {% endif %}
                        {% if technique.note != None %}
                            <p>{{ technique.note }}</p>
                        {% endif %}
                    </div>
                    <div id="{{ technique.id }}-note-edit-form" style="display: none;">
                        <form method="POST">
                            <textarea class="note-textarea" rows="4" cols="40">{{ technique.note }}</textarea>
                            <div>
                                <input class="save-button" type="submit" value="Save">
                            </div>
                        </form>
                    </div>
                    <div class="edit-note-div">
                        <button id="{{ technique.id }}-edit-note-button" class="submit-button" onclick="toggleNodeEdit('{{technique.id}}')">Edit Note</button>
                    </div>
                </div>
                

                <div class="note-and-delete-buttons">
                    <div>
                        <button id="{{ technique.id }}-note-button" class="see-note-button" onclick="toggleNote('{{technique.id}}')">See Note</button>
                    </div>
                    <div>
                        <a href="{% url 'remove' technique.id %}"><button class="delete-button">Remove</button></a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <script>
        function toggleNote(techniqueId) {
            const noteDiv = document.getElementById(techniqueId + '-note-div');
            const noteButton = document.getElementById(techniqueId + '-note-button');

            if (noteDiv.style.display === 'none') {
                noteDiv.style.display ='block';
                noteButton.innerText = 'Hide Note';
            } else {
                noteDiv.style.display = 'none';
                noteButton.innerText = 'See Note';
            }
        }

        function toggleNodeEdit(techniqueId) {
            const note = document.getElementById(techniqueId + '-note')
            const noteForm = document.getElementById(techniqueId + '-note-edit-form')
            const editNoteButton = document.getElementById(techniqueId + '-edit-note-button')

            if (note.style.display !== 'none') {
                note.style.display = 'none';
                noteForm.style.display = 'block';
                editNoteButton.innerText = 'Cancel';
            } else {
                note.style.display = 'block';
                noteForm.style.display = 'none';
                editNoteButton.innerText = 'Edit Note';
            }
        }
    </script>
{% endblock %}