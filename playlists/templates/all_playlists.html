{% extends 'base_playlists.html' %}
{% load static %}

{% block content %}
<div class="edit-playlist-wrapper">
    <h1>All Playlists</h1>
    
    <div class="go-back-div">
        <a href="{% url 'private' %}"><img src="{% static 'images/go-back.png' %}" class="small-icon"></a>
    </div>

    {% if messages %}
        <div class="error-message">
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <div>
        <img src="{% static 'images/new-playlist2.png' %}" alt="Add new" class="small-icon" style="cursor: pointer;" onclick="toggleNewPlaylistForm()">
    </div>

    <div id="new-playlist-form" class="new-playlist-name-div" style="display: none;">
        <form id="{{ technique.id }}-add-playlist-form" class="playlist-name-form" method="POST" data-url="{% url 'add_to_playlist' %}">
            {% csrf_token %}
            <p>New playlist name</p>
            <div>
                <input name="name" id="name">
                <button class="regular-button" onclick="addToNewPlaylist('{{ technique.id }}', event)">Submit</button>
            </div>
        </form>
    </div>

    <div class="all-playlists">
        {% for playlist, technique in playlist_and_technique.items %}
            <div class="one-playlist">
                <div class="playlist-left">
                    <div class="one-video-player">
                        {% if technique.video_option == 'full' %}
                            <iframe width="400" height="280" src="{{ technique.embed_url }}" frameborder="0" allowfullscreen></iframe>
                        {% endif %}
                        {% if technique.video_option == 'cropped' %}
                            <video width="400" height="280" controls>
                            <source src="../../{{ technique.cropped_video }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        {% endif %}
                    </div>
                </div>
                <div class="playlist-right">
                    <div class="playlist-name-div">
                        <p>{{ playlist.name|title }}</p>
                    </div>
                    <div class="the-rest-div">
                        <a class="the-rest-flex" href="{% url 'edit_playlist' playlist.id %}">
                            <p>See more from this playlist</p>
                            <img src="{% static 'images/arrow-icon2.png' %}" class="arrow-icon">
                        </a>
                    </div>
                    <div class="description-div">
                        {% if playlist.description %}
                            {{ playlist.description }}
                        {% else %}
                            <p>No description yet...</p>
                        {% endif %}
                    </div>
                    <div id="{{ playlist.id }}-delete-div" class="delete-icon-div">
                        <img id="" src="{% static 'images/remove-icon3.png' %}" alt="Delete" class="delete-icon"
                            onclick="toggleDeleteConfirmationDiv('{{playlist.id}}')">
                    </div>
                    <div id="{{playlist.id}}-confirmation-div" class="delete-confirmation-div" style="display: none;">
                        <p>Delete entire playlist?</p>
                        <div>
                            <a href="{% url 'delete_playlist' playlist.id %}"><button class="delete-playlist-button">Delete</button></a>
                            <button class="cancel-button" onclick="toggleDeleteConfirmationDiv('{{playlist.id}}')">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    function toggleNewPlaylistForm() {
        const newPlaylistForm = document.getElementById('new-playlist-form');

        if (newPlaylistForm.style.display === 'block') {
            newPlaylistForm.style.display = 'none';
        } else {
            newPlaylistForm.style.display = 'block';
        }
    }
    function toggleDeleteConfirmationDiv(playlistId) {
        const deleteDiv = document.getElementById(playlistId + '-delete-div');
        const confirmationDiv = document.getElementById(playlistId + '-confirmation-div');

        if(confirmationDiv.style.display === 'none') {
            deleteDiv.style.display = 'none';
            confirmationDiv.style.display = 'flex';
        } else {
            deleteDiv.style.display = 'block';
            confirmationDiv.style.display = 'none';
        }
    }

</script>

{% endblock %}